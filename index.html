<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>动动球</title>
	<style>
		body {
			margin: 0;
			overflow: hidden;
		}
		.bubble {
			background-image: url("1.jpg"); /* 👈 替换这里 */
			background-size: cover;
			background-position: center;
			display: block;
		}
	</style>
</head>
<body>
	<canvas class="bubble"></canvas>
	<script>
		var h = window.innerHeight,
			w = window.innerWidth,
			nBubble = [];
		var canvas = document.getElementsByClassName('bubble')[0],
			conT = canvas.getContext('2d');

		(function () {
			canvas.width = w;
			canvas.height = h;
			window.onresize = function () {
				h = window.innerHeight;
				w = window.innerWidth;
				canvas.width = w;
				canvas.height = h;
			}
		})();

		function Bubble(x, y) {
			this.colorData = [
				"rgb(94,213,209)",
				"rgb(255,110,151)",
				"rgb(199,255,236)",
				"rgb(0,255,128)",
				"rgb(208,233,255)"
			];
			if (arguments.length === 0) {
				this.init();
			} else {
				this.init(x, y);
			}
			this.draw();
			this.vX = random(-1, 1);
			this.vY = random(-1, 1);
			this.createdAt = Date.now(); // 添加创建时间
		}

		Bubble.prototype = {
			init: function (x, y) {
				if (arguments.length === 0) {
					this.x = random(0, w);
					this.y = random(0, h);
					this.r = random(3, 18); // 默认气泡半径
				} else {
					this.x = x;
					this.y = y;
					this.r = random(8, 18); // 鼠标/触摸生成的大气泡
				}
				this.color = this.colorData[Math.floor(random(0, 5))];
			},
			draw: function () {
				conT.beginPath();
				conT.fillStyle = this.color;
				conT.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
				conT.fill();
			},
			move: function () {
				this.x += this.vX;
				this.y += this.vY;
			},
			conllisionDect: function () {
				if (this.x - this.r < 0 || this.x + this.r > w) {
					this.vX = -this.vX;
				}
				if (this.y - this.r < 0 || this.y + this.r > h) {
					this.vY = -this.vY;
				}
			}
		};

		creat(200);

		window.setInterval(function () {
			conT.clearRect(0, 0, w, h);
			let now = Date.now();
			// 删除超过8秒的气泡
			nBubble = nBubble.filter(b => now - b.createdAt < 8000);

			for (let bubble of nBubble) {
				bubble.move();
				bubble.draw();
				bubble.conllisionDect();
			}
		}, 1000 / 60);

		canvas.addEventListener('mousemove', function (e) {
			var x = e.pageX,
				y = e.pageY;
			nBubble.push(new Bubble(x, y));
		});

		canvas.addEventListener('touchmove', function (e) {
			e.preventDefault(); // 阻止页面滚动
			var touch = e.touches[0];
			var x = touch.pageX,
				y = touch.pageY;
			nBubble.push(new Bubble(x, y));
		}, { passive: false });

		function random(min, max) {
			return Math.random() * (max - min) + min;
		}

		function creat(num) {
			for (var i = 0; i < num; i++) {
				nBubble[i] = new Bubble();
			}
		}
	</script>
</body>
</html>
